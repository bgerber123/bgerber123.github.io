---
title: "GLMM Assignment"
author: "Elke"
date: "09-30-2024"
output: html_document
---

<style type="text/css">
  body{
  font-size: 12pt;
}
pre{
  font-size: 16px; 
}
</style>

### **Objective**
Create a report using Markdown that presents code, results, and summarized findings that makes inference to the occurence of the Annamite striped rabbit (*Nesolagus timminsi*) across multiple protected areas in Vietnam.

### **Background**
This is not real data. However, the basic premise has been adopted from the paper, [Getting the big picture: Landscape-scale occupancy patterns of two Annamite endemics among multiple protected areas](https://conbio.onlinelibrary.wiley.com/doi/full/10.1111/csp2.620).


### **Overview**
The Annamite striped rabbit is a forest-dwelling lagomorph that was discovered by science in the mid-1990s. Little is known about this species. What has been done indicates that hunting pressure is a primary driver of its distribution. As such, protected areas are paramount to their conservation. However, protected areas vary in their effectiveness in limiting hunting and some protected areas are founded on multi-use, such that hunting is still allowed. 


<p align="center">
<img src="Annamite striped rabbit.png" width="750"/>
</p>

```{r setup, include=FALSE}

# CRAN packages
#install.packages(c("glmmTMB","broom.mixed","lme4"))
#install.packages("marginaleffects")
library("marginaleffects")
#install.packages("ggResidpanel")
#install.packages("Matrix")
library(ggResidpanel)
library(broom.mixed)
library(glmmTMB)
library(lme4)
library(Matrix)
```

# Exploring data
```{r}
# Creating Data set

rabbitdata = read.csv("rabbit.occ.data.csv")

# Explore

summary(rabbitdata)
hist(rabbitdata$occur)
str(rabbitdata)

```

# Fitting a GLMM model
```{r}

# Fitting model
model1 <- glmer(occur ~ dist.human + (dist.human | PA), 
                    data = rabbitdata, 
                    family = binomial)

# View summary of the model
summary(model1)
# Check assumptions
resid_panel(model1)


# Confidence intervals for each PA
broom.mixed::tidy(model1, effects = "ran_vals", conf.int = TRUE)
#print(ci)

```

The model indicates a low probability of rabbit occurrence when distance to human activity is zero, but the probability increases with increasing distance.
The random effect variance for dist.human across protected areas is very low (1.489e-08), suggesting that the effect of distance on rabbit occurrence does not vary much between areas. The standard deviation is 
0.0003342 which is also quite small, reinforcing the idea that the differences in dist.human between areas are not substantial. Looking at the CI across the PA's, we see a lot of intervals that include 0. This again, indicates that the effect of distance to humans on rabbit occurrence does not vary between PA.

The effect of distance to humans on rabbit occurrence is statistically clear, implying that this factor is important in predicting rabbit occurrence. The confidence interval of dist.human does not include 0, indicating a statistically clear effect of the dist.human variable on the response (occupancy).

# Predictions
```{r}
# Make predictions
plot1 = marginaleffects:: plot_predictions(model1, condition=c("dist.human", "PA"), type="response")

# Plot Predictions
plot(plot1) 

# Rabbit occurrence at a typical site
Plot2= predict(model1,type="response",re.form=NA)[1]
print(Plot2)

```
In this prediction plot you can see that the slopes of each PA follow a similar pattern and are not so different from each other. Generally speaking, as distance to humans increases, rabbit occurrence does as well. The CIs of some of the PA, especially PA3 are very big, confirming that there is a lot of uncertainty about the effect of PA.

At a typical site rabbit occurrence is around 0.14, indicating rabbit occurrence is typically quite low. Depending on available data about these rabbits this might be either high, expected, or low, and could give a very general indication of how the rabbits might be doing. This can be an important piece of information for managers to take (or not take) action.

Although the intercept for each PA is quite low, there are not all the same. However, given the low variance between PA's, the difference between intercepts might not be relevant.

# Conclusions and Suggestions
Distance to humans has a statistically clear positive effect on Annamite striped rabbit occurrence. However, this effect does not vary clearly between protected areas. Typically, rabbit occurrence is at 0.14, which seems to be quite low. The first hypothesis is supported ("... that increasing distance away from human activity will lead to higher rabbit occupancy"). The second hypothesis is not ("..effect will vary by protected area because there is different levels of patrolling and enforcement"). Although the intercepts between PA's are not the exact same, the difference between is not statistically clear. Therefore, the third hypothesis seems to be supported as well (".. that occurrence at the edge of the protected areas nearest to human activity will be the same because of the similar density of people and that occurrence will be very low").

Given these conclusions, looking further into hunting activities in each PA is an important next step into understanding the effect of hunting on Annamite striped rabbits. 




