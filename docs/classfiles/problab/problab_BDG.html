<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Brian D. Gerber">
<meta name="dcterms.date" content="2024-08-02">
<title>Brian D. Gerber - Probability Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Brian D. Gerber</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../projects/index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../lab/index.html"> 
<span class="menu-text">Lab</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications/publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../FW680A4/index.html"> 
<span class="menu-text">FW680A4</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=ep25z9AAAAAJ&amp;hl=en"> <i class="bi bi-google" role="img">
</i> 
<span class="menu-text">Scholar</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.researchgate.net/profile/Brian-Gerber-4"> <i class="bi bi-r-square-fill" role="img">
</i> 
<span class="menu-text">RG</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/bgerber123"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">Github</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="mailto:brian.gerber@colostate.edu"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text">Email</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#objectives-exercises" id="toc-objectives-exercises" class="nav-link active" data-scroll-target="#objectives-exercises">Objectives / Exercises</a></li>
  <li>
<a href="#objective-1" id="toc-objective-1" class="nav-link" data-scroll-target="#objective-1">Objective 1</a>
  <ul class="collapse">
<li><a href="#exercise-1a" id="toc-exercise-1a" class="nav-link" data-scroll-target="#exercise-1a">Exercise 1a</a></li>
  <li><a href="#exercise-1b" id="toc-exercise-1b" class="nav-link" data-scroll-target="#exercise-1b">Exercise 1b</a></li>
  </ul>
</li>
  <li>
<a href="#objective-2" id="toc-objective-2" class="nav-link" data-scroll-target="#objective-2">Objective 2</a>
  <ul class="collapse">
<li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise 2</a></li>
  </ul>
</li>
  <li>
<a href="#objective-3" id="toc-objective-3" class="nav-link" data-scroll-target="#objective-3">Objective 3</a>
  <ul class="collapse">
<li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise 3</a></li>
  </ul>
</li>
  <li>
<a href="#discrete-uniform" id="toc-discrete-uniform" class="nav-link" data-scroll-target="#discrete-uniform">Discrete Uniform</a>
  <ul class="collapse">
<li><a href="#support" id="toc-support" class="nav-link" data-scroll-target="#support"><strong>Support</strong></a></li>
  <li><a href="#probability-function" id="toc-probability-function" class="nav-link" data-scroll-target="#probability-function"><strong>Probability Function</strong></a></li>
  <li><a href="#meanvariance" id="toc-meanvariance" class="nav-link" data-scroll-target="#meanvariance"><strong>Mean/Variance</strong></a></li>
  <li><a href="#plotting" id="toc-plotting" class="nav-link" data-scroll-target="#plotting"><strong>Plotting</strong></a></li>
  <li><a href="#probability" id="toc-probability" class="nav-link" data-scroll-target="#probability"><strong>Probability</strong></a></li>
  <li><a href="#sampling" id="toc-sampling" class="nav-link" data-scroll-target="#sampling"><strong>Sampling</strong></a></li>
  <li><a href="#ecological-data" id="toc-ecological-data" class="nav-link" data-scroll-target="#ecological-data"><strong>Ecological Data</strong></a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Probability Lab</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brian D. Gerber </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 2, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header><style type="text/css">

body, td {
   font-size: 16px;
}
code.r{
  font-size: 16px;
}
pre {
  font-size: 16px
}
</style>
<section id="objectives-exercises" class="level2"><h2 class="anchored" data-anchor-id="objectives-exercises">Objectives / Exercises</h2>
<ul>
<li>Objective 1) Get acquainted with the <a href="https://en.wikipedia.org/wiki/Binomial_distribution">Bernoulli/Binomial</a> probability mass function (PMF)</li>
<li>Exercise 1a) Evaluate sample size requirements for tagging studies to asses survival</li>
<li>Exercise 1b) Evaluate the robustness of our findings by varying the true value</li>
</ul>
<ul>
<li>Objective 2) Get acquainted with the <a href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson</a> PMF</li>
<li>Exercise 2) Evaluate sample size requirements for assessing a species’ mean relative abundance</li>
</ul>
<ul>
<li>Objective 3) Get acquainted with a probability function you do not know well and additional markdown features</li>
<li>Exercise 3) Use markdown to create a summary of a chosen probability function</li>
</ul></section><section id="objective-1" class="level2"><h2 class="anchored" data-anchor-id="objective-1">Objective 1</h2>
<p>Lets explore the <a href="https://en.wikipedia.org/wiki/Binomial_distribution">Bernoulli/Binomial</a> probability mass function (PMF). Imagine doing a tagging study to estimate the survival of <a href="https://www.allaboutbirds.org/guide/Sandhill_Crane/overview">sandhill cranes</a> in New Mexico over the winter. We want to use the PMF to connect the ideas of generating data via a probability distribution that is defined by parameters.</p>
<p>In this situation, we are interested in simulating samples or observations (or more generally, generate synthetic data) of where cranes either lived (<span class="math inline">\(y = 1\)</span>) or died (<em>y = 0</em>) over our period of interest (winter). If we use the Bernoulli PMF our focus is typically on each i<span class="math inline">\(^th\)</span> crane, while if we are interested in the sum of the number of cranes that lived (<span class="math inline">\(\sum_{i}^n y_i\)</span>) than we would use the Binomial PMF. Either way, we need to define the parameter associeted with both function, which is the probability of observing a 1 (<span class="math inline">\(P(Y=1)\)</span>), which we will define here as <span class="math inline">\(\theta\)</span>. To make this a useful exercise, we want to decide on <span class="math inline">\(\theta\)</span> could be <em>in real life</em>.</p>
<p>Remember, estimation is turning the process around and having data to inform the parameter. Before we do estimation, we want to understand probability functions through simulating/generating synthetic data so we have a better idea of what we are assuming about our empirical data when we use probability functions to estimate parameters. Plus, this process can help us guide our design of future studies.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Define sandhill crane over winter survival probability (P(Y=1))</span></span>
<span> <span class="va">theta</span> <span class="op">=</span> <span class="fl">0.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The Bernoulli PMF is useful when thinking about a single event, happening once. Remember, this is a limiting case of the Binomial PMF. We will use the same function, but change the inputs.</p>
<p>Lets observe/generate a single data point where a crane dies (y = 0) or lives (y = 1). In a sense, we are flipping a theoretical coin with probability theta (i.e., <span class="math inline">\(P(Y = 1) = \theta\)</span>) to observe/sample whether this tagged crane dies or lives.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">1</span>,prob <span class="op">=</span> <span class="va">theta</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Consider 10 tagged cranes to get a sample of the number of alive cranes (success’ or 1’s) at the end of the study</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">10</span>, prob <span class="op">=</span> <span class="va">theta</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
</div>
<p>Now, consider 10 tagged cranes and you want to keep track of each bird and whether they lived or died (not just the sum of the alive ones).</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, size <span class="op">=</span> <span class="fl">1</span>,prob <span class="op">=</span> <span class="va">theta</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 1 1 0 1 1 1</code></pre>
</div>
</div>
<p>Notice that changing the arguments ‘size’ and ‘n’ either focuses on the individual event of 0 and 1’s (size = 1) or the sum of the 1’s (size &gt; 1). n controls how many of those outputs you would like to have</p>
<p>What if we wanted to generate synthetic data of mortality, rather than survival? Well, we just change our setup. Still assuming survival probability is 0.80, than the equivalent mortality probability would be <span class="math inline">\(\theta = 1 - 0.80 = 0.20\)</span>, such the we are saying the probability a crane dies is <span class="math inline">\(P(Y = 1) = \theta = 0.2\)</span> Now, we can generate data of cranes that have died (1) and that have lived (0).</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">theta</span> <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, size <span class="op">=</span> <span class="fl">1</span>,prob <span class="op">=</span> <span class="va">theta</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 0 0 0 0 0 0 1 0 1</code></pre>
</div>
</div>
<p>What is <code>rbinom</code> really doing? Well, the <a href="https://github.com/SurajGupta/r-source/blob/master/src/nmath/rbinom.c">code</a> is actually calling a function using the C programming language because it is fast. But, we can understand more simply what the binomial sampling process looks like by using the generic <code>sample</code> function.</p>
<p>The code here defines the outcomes of the stochastic process as either a 0 or 1; <code>x</code> is the argument name of the function. We are asking for 10 trials using <code>size</code>. The <code>replace</code> argument is telling the sampler that we are allowing it sample each outcome (0 and 1) more than one time. Lastly, we are defining the <span class="math inline">\(P(y = 1)\)</span> to be 0.80 and the <span class="math inline">\(P(y = 0)\)</span> to be 0.20. This code replicates the same process as the code above: <code>rbinom(n = 10, size = 1,prob = theta)</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>       size <span class="op">=</span> <span class="fl">10</span>, </span>
<span>       replace<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>       prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">0.2</span><span class="op">)</span></span>
<span>       <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 0 1 1 1 1 1 0</code></pre>
</div>
</div>
<section id="exercise-1a" class="level3"><h3 class="anchored" data-anchor-id="exercise-1a">Exercise 1a</h3>
<p>Use your knowledge of the Binomial PMF and investigate the study design trade offs of a tagging study to estimate the survival of sandhill cranes. Consider 3 sample sizes of tagged individuals (N): 100, 250, and 500. Define the survival probability as <code>$\theta$ = 0.80</code>. For each sample, estimate the probability of survival using the estimator <span class="math inline">\(\sum(y)/N\)</span>, where <code>y</code> is the number of alive cranes at the end of the study and <code>N</code> is the number of total tagged cranes. We will justify this decision at a later point, but logically this should be a good estimator. For each sample size, you want to approximate the sampling distribution of the estimator. Once you have each sampling distribution,</p>
<ul>
<li>display the three sampling distributions on a single plot</li>
<li>evaluate estimator bias and relative bias. Is the estimator biased?</li>
<li>estimate the probability a given sample mean will be within 10% of the true values (<code>theta</code>).</li>
<li>determine the most cost efficient number of tags to use such that there is 0.90 probability that a single sample mean is within 10% of the true value</li>
</ul>
<p>Note: make sure you use enough replicates such that the sampling distribution appears well approximated (i.e., symmetric).</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="va">n.sim</span> <span class="op">=</span> <span class="fl">5000</span></span>
<span>  <span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">250</span>,<span class="fl">500</span><span class="op">)</span></span>
<span>  <span class="va">theta</span> <span class="op">=</span> <span class="fl">0.8</span></span>
<span>  <span class="va">theta.hat</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">n.sim</span>, ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">theta.hat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n.sim</span>, <span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">theta</span><span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">theta.hat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n.sim</span>, <span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">theta</span><span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">theta.hat</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n.sim</span>, <span class="va">n</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">theta</span><span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">plot.data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>theta.hat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">theta.hat</span><span class="op">)</span>, N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"10"</span>,<span class="va">n.sim</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"100"</span>,<span class="va">n.sim</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"1000"</span>,<span class="va">n.sim</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.data</span>,<span class="fu">aes</span><span class="op">(</span><span class="va">theta.hat</span>,fill<span class="op">=</span><span class="va">N</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span>,<span class="st">"green"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>     <span class="fu">geom_density</span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.5</span>,binwidth<span class="op">=</span><span class="fl">0.05</span>,position<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_density(alpha = 0.5, binwidth = 0.05, position = "identity"):
Ignoring unknown parameters: `binwidth`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="problab_BDG_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The estimated bias and relative bias show that the estimator is unbiased.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bias</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">theta.hat</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span><span class="op">-</span><span class="va">theta</span></span>
<span><span class="va">bias</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.0006680 -0.0000856 -0.0001304</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">r.bias</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">theta.hat</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span><span class="op">-</span><span class="va">theta</span><span class="op">)</span><span class="op">/</span><span class="va">theta</span></span>
<span><span class="va">r.bias</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.000835 -0.000107 -0.000163</code></pre>
</div>
</div>
<p>A sample size of 250 tags is the best choice to minimize costs and meet the objective of having a 0.90 probability of being within 10% of the true value of <span class="math inline">\(\theta\)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="va">limits.truth</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">theta</span><span class="op">-</span><span class="va">theta</span><span class="op">*</span><span class="fl">0.05</span>,</span>
<span>                 <span class="va">theta</span><span class="op">+</span><span class="va">theta</span><span class="op">*</span><span class="fl">0.05</span></span>
<span>                 <span class="op">)</span></span>
<span>  <span class="va">my.func</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">x</span><span class="op">&gt;=</span><span class="va">limits.truth</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> </span>
<span>                                     <span class="va">x</span><span class="op">&lt;=</span><span class="va">limits.truth</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>                        <span class="op">}</span></span>
<span>  <span class="va">prob.truth</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">theta.hat</span>, <span class="fl">2</span>,FUN <span class="op">=</span> <span class="va">my.func</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, prob <span class="op">=</span> <span class="va">prob.truth</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    n   prob
1 100 0.7322
2 250 0.9046
3 500 0.9780</code></pre>
</div>
</div>
</section><section id="exercise-1b" class="level3"><h3 class="anchored" data-anchor-id="exercise-1b">Exercise 1b</h3>
<p>What if we are wrong about the assumed probability of survival? Well, we can evaluate this assumption! Rather than considering a single truth (<span class="math inline">\(\theta = 0.80\)</span>), we can instead consider a range of true values. This way we can evaluate the <strong>robustness</strong> of our findings. Meaning, if we find that a sample size of 250 meets our objective (0.90 probability of being within 10% of the true <span class="math inline">\(\theta\)</span>) across a range of assumed survival probabilities, we are can be confident in our recommendation of tagging 250 cranes. Keep in mind there is a lot of real world factors we have not accounted for yet!</p>
<p>Using a sample size of 250, evaluate whether there is at least 0.90 probability of being within 10% of the true <span class="math inline">\(\theta\)</span> where <span class="math inline">\(\theta\)</span> varies from 0.80 to 1.0 by increments of 0.05. For example, <code>theta = seq(0.7, 1, by = 0.05)</code>.</p>
<ul>
<li>for each value of <span class="math inline">\(\theta\)</span>, generate the sampling distribution of estimates of <span class="math inline">\(\theta\)</span> and then calculate the probability of being within 10% of that given values of <span class="math inline">\(\theta\)</span>
</li>
<li>plot these probabilities on a x-y line graph where the x axis is the true value (<span class="math inline">\(\theta\)</span>) and the y-axis is the estimated probabilities of interest</li>
<li>using the plot, decide whether the findings are robust to the choice of <span class="math inline">\(\theta\)</span>
</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="va">n.sim</span> <span class="op">=</span> <span class="fl">5000</span></span>
<span>  <span class="va">n</span> <span class="op">=</span> <span class="fl">250</span></span>
<span>  <span class="va">theta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1</span>, by<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span>  <span class="va">prob.obj</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">theta.hat</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n.sim</span>, <span class="va">n</span>, <span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">n</span></span>
<span>    </span>
<span>    <span class="va">limits.truth</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fl">0.05</span>,</span>
<span>                   <span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fl">0.05</span></span>
<span>                   <span class="op">)</span></span>
<span></span>
<span>    <span class="va">prob.obj</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">theta.hat</span><span class="op">&gt;=</span><span class="va">limits.truth</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> </span>
<span>                 <span class="va">theta.hat</span><span class="op">&lt;=</span><span class="va">limits.truth</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta.hat</span><span class="op">)</span></span>
<span>  <span class="op">}</span>  </span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">prob.obj</span>,type<span class="op">=</span><span class="st">"b"</span>,lwd<span class="op">=</span><span class="fl">3</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>       xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       ylab<span class="op">=</span><span class="st">"Probability of Objective"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0.90</span>,lwd<span class="op">=</span><span class="fl">3</span>,col<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="problab_BDG_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see that our objective (green horizontal line) is met or is higher at all values of <span class="math inline">\(\theta\)</span> ranging from 0.80 to 1.0.</p>
</section></section><section id="objective-2" class="level2"><h2 class="anchored" data-anchor-id="objective-2">Objective 2</h2>
<p>The <a href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson</a> PMF is often the distribution used first when considering count data. For example, counts of plants or animals within a given area. Its always a goog choice when needing to consider rates, such as counts per unit effort. Note that we are not going to think about detection probability at this point. Assuming constant detection probability, we can think of these counts as a measure of relative abundance.</p>
<p>Let’s say we are interested in counts of <a href="American Pika">American Pika</a> in 10x10 m plots throughout boulder fields in the Rocky Mountains. First, we need to define the mean count, defined as <span class="math inline">\(\lambda\)</span>. Then, we need to decide on how many plots to sample (<code>n</code>).</p>
<p>Sample 10 plots, count pika in each, where the true mean is 100.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, lambda <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  90  99  91  96 109  98 100 119 110  99</code></pre>
</div>
</div>
<p>Sample 10 plots where the mean is 2</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, lambda <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 3 3 1 0 2 2 1 3 0 2</code></pre>
</div>
</div>
<p>When considering the Poisson distribution, notice how few plots have zero pika. In ecological and wildlife sampling, zero counts are common for a variety of reasons. This is one reason people tend to model counts with two components - a Poisson distribution and a zero-inflated part. More about this later.</p>
<p>One of the interesting properties of the Poisson PMF is that it can be fully described with only one parameter (<span class="math inline">\(\lambda\)</span>), which defines the mean and variance as equivalent. This parameter governs the central tendency of the observations and how much it varies.</p>
<p>Lets look at this property by simulating 10000 counts and estimating the mean and variance.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">43243</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100000</span>, lambda <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.00741</code></pre>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.0551</code></pre>
</div>
</div>
<p>So, when using the Poisson distribution, we need to consider that the mean and variance will be assumed equal.</p>
<section id="exercise-2" class="level3"><h3 class="anchored" data-anchor-id="exercise-2">Exercise 2</h3>
<p>Evaluate the sampling distribution of the estimator <span class="math inline">\(\sum(y)/N\)</span>, where <code>y</code> are the counts and <code>N</code> is the number of counts. Assuming <span class="math inline">\(\lambda = 100\)</span>, determine how many sample plots are needed such that the probability a sample is within 5% of the mean is at least 95%. Once this is completed, change to <span class="math inline">\(\lambda  = 25\)</span>. How does your evaluation of the sample size change? Do you need the same, more, or less samples to achieve the same objective?</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Define inputs and outputs</span></span>
<span>  <span class="va">lambda</span> <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">500</span>,by<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="va">n.sim</span> <span class="op">=</span> <span class="fl">10000</span></span>
<span>  <span class="va">mean.mat</span> <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">n.sim</span>, ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop over the different sample sizes - n</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">y.temp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span></span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="va">n.sim</span>,</span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,lambda<span class="op">=</span><span class="va">lambda</span><span class="op">)</span></span>
<span>                            <span class="op">)</span>, nrow<span class="op">=</span><span class="va">n</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                  <span class="op">)</span></span>
<span>  <span class="co">#Estimate mean of each sample</span></span>
<span>  <span class="va">mean.temp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">y.temp</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span></span>
<span>  <span class="va">mean.mat</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mean.temp</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">mean.mat</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10000    99</code></pre>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Define 5% around truth</span></span>
<span>  <span class="va">limits.truth</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">-</span><span class="va">lambda</span><span class="op">*</span><span class="fl">0.025</span>,</span>
<span>                 <span class="va">lambda</span><span class="op">+</span><span class="va">lambda</span><span class="op">*</span><span class="fl">0.025</span></span>
<span>                 <span class="op">)</span></span>
<span></span>
<span><span class="co">#Estimate probability of being within 5%</span></span>
<span>  <span class="va">probs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mean.mat</span>,<span class="fl">2</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">x</span><span class="op">&gt;=</span><span class="va">limits.truth</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span></span>
<span>                                                        <span class="va">x</span><span class="op">&lt;=</span> <span class="va">limits.truth</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>                                                        <span class="op">)</span></span>
<span>                                                  <span class="op">)</span> <span class="op">/</span> <span class="va">n.sim</span> </span>
<span>                                         <span class="op">}</span></span>
<span>             <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the probability versus the sample size</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">n</span>,<span class="va">probs</span>,type<span class="op">=</span><span class="st">"l"</span>,lwd<span class="op">=</span><span class="fl">3</span>,col<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0.90</span>,lwd<span class="op">=</span><span class="fl">3</span>,col<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="problab_BDG_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We need 45 samples to achieve our objective.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="problab_BDG_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Changing to <span class="math inline">\(\lambda = 25\)</span>, we see that a lot more samples are needed to achieve the same objective (&gt;100).</p>
</section></section><section id="objective-3" class="level2"><h2 class="anchored" data-anchor-id="objective-3">Objective 3</h2>
<p>There are a lot of probability functions that are commonly used in wildlife and ecological modeling. Generally, a lot these functions fall within the <a href="https://en.wikipedia.org/wiki/Exponential_family">exponential family</a> of probability functions. The objective is to become a bit more familiar with a new probability function and to use the nice features of markdown to describe the function and its various properties.</p>
<section id="exercise-3" class="level3"><h3 class="anchored" data-anchor-id="exercise-3">Exercise 3</h3>
<p>Create a summary of a probability function of your choosing. If you aren’t sure pick from here: <a href="https://en.wikipedia.org/wiki/Binomial_distribution">Binomial</a>, <a href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson</a>, <a href="https://en.wikipedia.org/wiki/Log-normal_distribution">Log-Normal</a>, <a href="https://en.wikipedia.org/wiki/Beta_distribution">Beta</a>, or <a href="https://en.wikipedia.org/wiki/Gamma_distribution">Gamma</a>. If you feel comfortable with these distributions then choose from a long list of options from <a href="https://en.wikipedia.org/wiki/List_of_probability_distributions">wikipedia</a>.</p>
<p>Follow the example below for the Discrete Uniform probability distribution and …</p>
<ul>
<li>Define the random variable <span class="math inline">\(y\)</span> that is <span class="math inline">\(iid\)</span> from your distribution</li>
<li>Define the sample space and parameter space for each parameter</li>
<li>Include the equation of the probability density/mass function</li>
<li>Define the expected value (mean) and variance of the distribution (if they exist in closed form)</li>
<li>Visualize (plot outputs) the pdf/pmf using at least 2 sets of parameters</li>
<li>Demonstrate using code how to calculate the probability of data over certain ranges (e.g.&nbsp;pnorm).</li>
<li>Demonstrate how to find the values of data pertaining to a certain probability (e.g.&nbsp;qnorm).</li>
<li>Plot a small and large sample from the distribution. Comment on whether the samples looks like the PDF.</li>
<li>Provide an example of what type of data this probability function could be useful for</li>
</ul>
<p>For simplicity, use the setup below and swap in code and notation for your chosen probability function.</p>
<hr>
<hr></section></section><section id="discrete-uniform" class="level2"><h2 class="anchored" data-anchor-id="discrete-uniform">Discrete Uniform</h2>
<p>The discrete uniform distribution defines probabilities for a set of integer values ranging from a lower bound to an upper bound.</p>
<p><span class="math display">\[
y \sim \text{Uniform}(a,b)
\]</span></p>
<section id="support" class="level3"><h3 class="anchored" data-anchor-id="support"><strong>Support</strong></h3>
<p>The support of the random variable <span class="math inline">\(y\)</span> is <span class="math display">\[
y \in \{a, a+1,..., b-1, b\}
\]</span></p>
<p>The support of the parameters <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are all integers, where <span class="math inline">\(b \geq a\)</span>, and <span class="math inline">\(n = b-a+1\)</span>.</p>
</section><section id="probability-function" class="level3"><h3 class="anchored" data-anchor-id="probability-function"><strong>Probability Function</strong></h3>
<p><span class="math display">\[
f(y|a,b) = \frac{1}{n}
\]</span></p>
</section><section id="meanvariance" class="level3"><h3 class="anchored" data-anchor-id="meanvariance"><strong>Mean/Variance</strong></h3>
<p><span class="math display">\[
E[y] = \frac{a+b}{2}\\
Var[Y] = \frac{n^2-1}{12}
\]</span></p>
</section><section id="plotting" class="level3"><h3 class="anchored" data-anchor-id="plotting"><strong>Plotting</strong></h3>
<p>Example 1</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Parameters</span></span>
<span>  <span class="va">a</span><span class="op">=</span><span class="fl">1</span>; <span class="va">b</span><span class="op">=</span><span class="fl">5</span></span>
<span><span class="co"># Sample Space of RV</span></span>
<span>  <span class="va">x</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">n</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#plotting probability mass  </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="fl">2</span>,pch<span class="op">=</span><span class="fl">18</span>,cex<span class="op">=</span><span class="fl">3</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"f(y)"</span>,xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a = 1, b = 5"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="op">(</span><span class="va">a</span><span class="op">+</span><span class="va">b</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">3</span>,col<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,lwd<span class="op">=</span><span class="fl">3</span>,col<span class="op">=</span><span class="fl">4</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Mean"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="problab_BDG_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Example 2</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Parameters</span></span>
<span>  <span class="va">a</span><span class="op">=</span><span class="fl">10</span>; <span class="va">b</span><span class="op">=</span><span class="fl">100</span></span>
<span><span class="co">#Sample Space</span></span>
<span>  <span class="va">x</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">n</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#plotting probability mass    </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">x</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="fl">2</span>,pch<span class="op">=</span><span class="fl">18</span>,cex<span class="op">=</span><span class="fl">1</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"f(y)"</span>,xlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a = 10, b = 100"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="op">(</span><span class="va">a</span><span class="op">+</span><span class="va">b</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">3</span>,col<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,lwd<span class="op">=</span><span class="fl">3</span>,col<span class="op">=</span><span class="fl">4</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Mean"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="problab_BDG_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="probability" class="level3"><h3 class="anchored" data-anchor-id="probability"><strong>Probability</strong></h3>
<p>The probability of observing samples <span class="math inline">\(\geq\)</span> 60 when <span class="math inline">\(a\)</span> = 10 and <span class="math inline">\(b\)</span> =100 is,</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Parameters</span></span>
<span>  <span class="va">a</span><span class="op">=</span><span class="fl">10</span>; <span class="va">b</span><span class="op">=</span><span class="fl">100</span></span>
<span><span class="co">#Sample space</span></span>
<span>  <span class="va">x</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">n</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#Probability of any one value</span></span>
<span>  <span class="va">p</span><span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span></span>
<span>  <span class="va">p</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01098901</code></pre>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Add probabilities for all the integers &gt;=60</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">x</span><span class="op">&gt;=</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">p</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4505495</code></pre>
</div>
</div>
</section><section id="sampling" class="level3"><h3 class="anchored" data-anchor-id="sampling"><strong>Sampling</strong></h3>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Parameters</span></span>
<span>  <span class="va">a</span><span class="op">=</span><span class="fl">10</span>; <span class="va">b</span><span class="op">=</span><span class="fl">100</span></span>
<span></span>
<span><span class="co">#Sample at different sample sizes</span></span>
<span>  <span class="va">sample.size</span><span class="op">=</span><span class="fl">100</span></span>
<span>  <span class="va">sample.size2</span><span class="op">=</span><span class="fl">10000</span></span>
<span>  </span>
<span>  <span class="va">y</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">sample.size</span>,<span class="va">a</span>,<span class="va">b</span><span class="op">)</span>,digits<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">y2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">sample.size2</span>,<span class="va">a</span>,<span class="va">b</span><span class="op">)</span>,digits<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#plotting samples with True probability</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">y</span>,main<span class="op">=</span><span class="st">"N = 100"</span>,freq <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="va">p</span>,col<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">y2</span>,main<span class="op">=</span><span class="st">"N = 10000"</span>,freq <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="va">p</span>,col<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="problab_BDG_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Even at a sample size of 10000, the probabilities are still a bit wonky from the truth, but close. Certainly a lot close to the sample size at 100.</p>
</section><section id="ecological-data" class="level3"><h3 class="anchored" data-anchor-id="ecological-data"><strong>Ecological Data</strong></h3>
<p>The discrete uniform is not a very useful probability distribution for data. However, it is commonly used as a prior probability distribution when fitting a model using Bayesian inference for parameters that can only be integers within a given range.</p>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block">© 2023 Brian D. Gerber CC BY-SA 4.0</span></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>